# Archived Tasks - January 2025

This file contains completed tasks that were archived from docs/task.md.
Tasks 1-50 are stored here to keep the active task tracker under 300 lines.

---

## Tasks 1-17

Previously archived (details not preserved).

---

## Tasks 18-29

### 18. Debug friend request "User not found" issue
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/FriendService.swift
- **Solution**: Issue found - Firestore index missing for username queries.

### 19. Fix Firestore index error for notifications query
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Created composite index in Firebase Console.

### 20. Add unread notification count to notifications section header
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added unreadCount computed property and red badge styling.

### 21. Remove username editing capability from profile
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Verified username is already read-only.

### 22. Fix profile display name not updating
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Refactored ProfileView to use ProfileViewModel's @Published properties.

### 23. Hide email from friend detail view
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed email from FriendProfile model and FriendDetailView.

### 24. Add settings menu to all screens
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created SettingsMenu.swift component.

### 25. Auto-save profile changes when switching tabs
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onDisappear modifier for auto-save.

### 26. Remove switch accounts button
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed button and deleted AccountSwitcherView.swift.

### 27. Change menu to popover style
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Replaced Menu with Button + popover.

### 28. Debug and fix app crash on launch
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Fixed Firebase initialization race condition with lazy var.

### 29. Fix crash when exiting messaging screen
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Removed unsafe nonisolated deinit pattern.

---

## Tasks 30-50

### 30. Improve messaging UX with swipe-to-reveal timestamps
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Features moved to backlog after implementation issues.

### 31. Integrate Spotify API to access user playlists
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Implemented OAuth 2.0 flow, Keychain token storage, and API methods.

### 32. Implement Spotify song search in Search tab
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created SearchViewModel and SearchView with debounced search.

### 33. Implement AVPlayer song preview in search results
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created AudioPlayerService, iTunesService, and SoundWaveBar animation.

### 34. Send songs from search to friends with playable previews
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added send button, FriendPickerView, and connected to AudioPlayerService.

### 35. Send messages with Return/Enter key
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onSubmit and submitLabel(.send) to TextField.

### 36. Implement vibestreaks tracking
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Complete vibestreak system with daily interaction tracking and milestones.

### 37. Implement group chats
- **Status**: DEFERRED
- **Type**: Feature
- **Solution**: Moved to backlog due to Firestore index issues.

### 38. Add songs to Spotify playlist
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: PlaylistPickerView with addTrackToPlaylist API integration.

### 39. Phase 1: Tab Structure & Profile Foundation
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added Discover tab, listening stats to Profile, reordered tabs.

### 40. Phase 2: Discover Tab (New Home)
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: New releases, recommendations, friend activity, trending songs.

### 41. Phase 3: Search Enhancements
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Recent searches, type filters, improved results UI.

### 42. Album/Playlist/Artist Detail Views
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created detail views with playable track lists.

### 43. Fix preview playback using iTunes
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Updated detail views to use iTunes preview URLs.

### 44. Phase 4: Chats Enhancements
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Visual refresh, song reactions, playlist sharing.

### 45. Phase 5: Polish & Gamification
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Vibestreak rewards, music personality card, achievements, onboarding.

### 46. Forgot Password Flow
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: ForgotPasswordView with Firebase sendPasswordReset.

### 47. Profile Picture Upload
- **Status**: REMOVED
- **Type**: Feature
- **Solution**: Feature removed - user does not have Firebase Storage.

### 48. Online Status Indicators
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added presence fields, updatePresence methods, green dot indicator.

### 49. Delete Account
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: DeleteAccountView with comprehensive data deletion.

### 50. AI-Powered Recommendations & Playlist Bridging
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: OpenAI GPT-4 integration with themed playlists and friend blends.

---

## Tasks 51-80

### 51. Add haptic feedback throughout app
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created HapticService.swift with static methods. Added haptics throughout all interactive views.

### 52. Replace song action buttons with long-press context menu
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed buttons, added .contextMenu with options and haptic feedback.

### 53. Add context menu to all song views throughout app
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added context menu to all track rows (ArtistDetailView, AlbumDetailView, PlaylistDetailView, DiscoverView).

### 54. Fix profile picture upload error
- **Status**: N/A (Feature Removed)
- **Type**: Bug
- **Solution**: Profile picture feature removed - user does not have Firebase Storage.

### 55. Add achievement unlock banner and real-time updates
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created AchievementNotificationService with banner overlay and slide-down animation.

### 56. Add context menu to recently played and top songs in Profile
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added context menus and made top artists clickable to ArtistDetailView.

### 57. Move AI Features from menu to Profile next to Connect Spotify
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed from SettingsMenu, added aiFeaturesSection to ProfileView.

### 58. Real-time Now Playing
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created NowPlayingService that polls Spotify and updates Firestore. Added Now Playing section to ChatsView.

### 59. Predefined genre selection
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created GenrePickerView with 35 predefined genres in a grid picker.

### 60. Smooth animations and transitions
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added spring animations for messages, reactions, Now Playing cards, and genre chips.

### 61. Add play functionality to profile top songs and recently played
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Made TopTrackRow and RecentlyPlayedCell tappable to play. Added iTunes fallback for previews.

### 62. Sort conversations by most recent message
- **Status**: ABANDONED
- **Type**: Bug
- **Solution**: Reverted due to Firestore listener conflicts. Basic sorting via Firestore remains.

### 63. Fix duplicate song playing indicator across entire app
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Used unique identifiers per song instance (message.id, rank-based, timestamp-based).

### 64. Standardize context menu on all songs app-wide
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: All songs now have: Send to Friend, Add to Playlist, Open in Spotify.

### 65. Wrong song plays for certain tracks
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Fixed iTunesService matching with scoring system and proper name normalization.

### 66. Add 50 more achievements
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added 50 new achievements across 8 categories including 5 secret achievements.

### 67. Reorganize Profile tab into Settings with 3 subtabs
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added Profile, Stats, Achievements subtabs with segmented picker.

### 68. Fix Settings subtab order and Stats page appearance
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Reordered to Profile/Stats/Achievements, changed time range to menu style.

### 69. Replace Edit Profile menu option with Settings
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Changed to "Settings" with gearshape icon, navigates to tab 3.

### 70. Show completed achievements in grid view
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Changed grid to show up to 8 unlocked achievements.

### 71. Fix achievement notifications re-appearing and clear all data on account delete
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Made tracking user-specific, added clearUserData() methods for account deletion.

### 72. Add AI Blend feature to Discover tab
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added BlendableFriend cards sorted by messaging frequency in AI Features section.

### 73. Make AI menu song rows tappable to play
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onTapGesture to ResolvedSongRow and BlendSongRow.

### 74. Balance blend data between both users
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added favoriteArtists to FriendProfile, both users now contribute similar data.

### 75. Make blend achievements work
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Added blendsCreated increment and soulmate detection (score >= 0.9).

### 76. Add AI-powered new music recommendations to Discover
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added generatePersonalizedRecommendations() with 12-hour cache and "AI Picks For You" section.

### 77. Fix compiler warnings across codebase
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Fixed self-capture, unnecessary casts, unused variables, deprecated onChange.

### 78. Stop audio when song leaves screen
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onDisappear { audioPlayer.stop() } to all 9 views with playable songs.

### 79. Show achievement banners immediately when earned
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added checkLocalAchievements() calls after every stat increment.

### 80. AI Picks not generating enough songs
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Increased initial request to 25 songs with retry loop up to 3 attempts.

---
