# Archived Tasks - January 2025

This file contains completed tasks that were archived from docs/task.md.
Tasks 1-50 are stored here to keep the active task tracker under 300 lines.

---

## Tasks 1-17

Previously archived (details not preserved).

---

## Tasks 18-29

### 18. Debug friend request "User not found" issue
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/FriendService.swift
- **Solution**: Issue found - Firestore index missing for username queries.

### 19. Fix Firestore index error for notifications query
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Created composite index in Firebase Console.

### 20. Add unread notification count to notifications section header
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added unreadCount computed property and red badge styling.

### 21. Remove username editing capability from profile
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Verified username is already read-only.

### 22. Fix profile display name not updating
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Refactored ProfileView to use ProfileViewModel's @Published properties.

### 23. Hide email from friend detail view
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed email from FriendProfile model and FriendDetailView.

### 24. Add settings menu to all screens
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created SettingsMenu.swift component.

### 25. Auto-save profile changes when switching tabs
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onDisappear modifier for auto-save.

### 26. Remove switch accounts button
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed button and deleted AccountSwitcherView.swift.

### 27. Change menu to popover style
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Replaced Menu with Button + popover.

### 28. Debug and fix app crash on launch
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Fixed Firebase initialization race condition with lazy var.

### 29. Fix crash when exiting messaging screen
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Removed unsafe nonisolated deinit pattern.

---

## Tasks 30-50

### 30. Improve messaging UX with swipe-to-reveal timestamps
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Features moved to backlog after implementation issues.

### 31. Integrate Spotify API to access user playlists
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Implemented OAuth 2.0 flow, Keychain token storage, and API methods.

### 32. Implement Spotify song search in Search tab
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created SearchViewModel and SearchView with debounced search.

### 33. Implement AVPlayer song preview in search results
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created AudioPlayerService, iTunesService, and SoundWaveBar animation.

### 34. Send songs from search to friends with playable previews
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added send button, FriendPickerView, and connected to AudioPlayerService.

### 35. Send messages with Return/Enter key
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onSubmit and submitLabel(.send) to TextField.

### 36. Implement vibestreaks tracking
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Complete vibestreak system with daily interaction tracking and milestones.

### 37. Implement group chats
- **Status**: DEFERRED
- **Type**: Feature
- **Solution**: Moved to backlog due to Firestore index issues.

### 38. Add songs to Spotify playlist
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: PlaylistPickerView with addTrackToPlaylist API integration.

### 39. Phase 1: Tab Structure & Profile Foundation
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added Discover tab, listening stats to Profile, reordered tabs.

### 40. Phase 2: Discover Tab (New Home)
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: New releases, recommendations, friend activity, trending songs.

### 41. Phase 3: Search Enhancements
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Recent searches, type filters, improved results UI.

### 42. Album/Playlist/Artist Detail Views
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created detail views with playable track lists.

### 43. Fix preview playback using iTunes
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Updated detail views to use iTunes preview URLs.

### 44. Phase 4: Chats Enhancements
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Visual refresh, song reactions, playlist sharing.

### 45. Phase 5: Polish & Gamification
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Vibestreak rewards, music personality card, achievements, onboarding.

### 46. Forgot Password Flow
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: ForgotPasswordView with Firebase sendPasswordReset.

### 47. Profile Picture Upload
- **Status**: REMOVED
- **Type**: Feature
- **Solution**: Feature removed - user does not have Firebase Storage.

### 48. Online Status Indicators
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added presence fields, updatePresence methods, green dot indicator.

### 49. Delete Account
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: DeleteAccountView with comprehensive data deletion.

### 50. AI-Powered Recommendations & Playlist Bridging
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: OpenAI GPT-4 integration with themed playlists and friend blends.

---

## Tasks 51-80

### 51. Add haptic feedback throughout app
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created HapticService.swift with static methods. Added haptics throughout all interactive views.

### 52. Replace song action buttons with long-press context menu
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed buttons, added .contextMenu with options and haptic feedback.

### 53. Add context menu to all song views throughout app
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added context menu to all track rows (ArtistDetailView, AlbumDetailView, PlaylistDetailView, DiscoverView).

### 54. Fix profile picture upload error
- **Status**: N/A (Feature Removed)
- **Type**: Bug
- **Solution**: Profile picture feature removed - user does not have Firebase Storage.

### 55. Add achievement unlock banner and real-time updates
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created AchievementNotificationService with banner overlay and slide-down animation.

### 56. Add context menu to recently played and top songs in Profile
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added context menus and made top artists clickable to ArtistDetailView.

### 57. Move AI Features from menu to Profile next to Connect Spotify
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Removed from SettingsMenu, added aiFeaturesSection to ProfileView.

### 58. Real-time Now Playing
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created NowPlayingService that polls Spotify and updates Firestore. Added Now Playing section to ChatsView.

### 59. Predefined genre selection
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Created GenrePickerView with 35 predefined genres in a grid picker.

### 60. Smooth animations and transitions
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added spring animations for messages, reactions, Now Playing cards, and genre chips.

### 61. Add play functionality to profile top songs and recently played
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Made TopTrackRow and RecentlyPlayedCell tappable to play. Added iTunes fallback for previews.

### 62. Sort conversations by most recent message
- **Status**: ABANDONED
- **Type**: Bug
- **Solution**: Reverted due to Firestore listener conflicts. Basic sorting via Firestore remains.

### 63. Fix duplicate song playing indicator across entire app
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Used unique identifiers per song instance (message.id, rank-based, timestamp-based).

### 64. Standardize context menu on all songs app-wide
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: All songs now have: Send to Friend, Add to Playlist, Open in Spotify.

### 65. Wrong song plays for certain tracks
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Fixed iTunesService matching with scoring system and proper name normalization.

### 66. Add 50 more achievements
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added 50 new achievements across 8 categories including 5 secret achievements.

### 67. Reorganize Profile tab into Settings with 3 subtabs
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added Profile, Stats, Achievements subtabs with segmented picker.

### 68. Fix Settings subtab order and Stats page appearance
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Reordered to Profile/Stats/Achievements, changed time range to menu style.

### 69. Replace Edit Profile menu option with Settings
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Changed to "Settings" with gearshape icon, navigates to tab 3.

### 70. Show completed achievements in grid view
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Changed grid to show up to 8 unlocked achievements.

### 71. Fix achievement notifications re-appearing and clear all data on account delete
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Made tracking user-specific, added clearUserData() methods for account deletion.

### 72. Add AI Blend feature to Discover tab
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added BlendableFriend cards sorted by messaging frequency in AI Features section.

### 73. Make AI menu song rows tappable to play
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onTapGesture to ResolvedSongRow and BlendSongRow.

### 74. Balance blend data between both users
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added favoriteArtists to FriendProfile, both users now contribute similar data.

### 75. Make blend achievements work
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Added blendsCreated increment and soulmate detection (score >= 0.9).

### 76. Add AI-powered new music recommendations to Discover
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added generatePersonalizedRecommendations() with 12-hour cache and "AI Picks For You" section.

### 77. Fix compiler warnings across codebase
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Fixed self-capture, unnecessary casts, unused variables, deprecated onChange.

### 78. Stop audio when song leaves screen
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added onDisappear { audioPlayer.stop() } to all 9 views with playable songs.

### 79. Show achievement banners immediately when earned
- **Status**: COMPLETED
- **Type**: Feature
- **Solution**: Added checkLocalAchievements() calls after every stat increment.

### 80. AI Picks not generating enough songs
- **Status**: COMPLETED
- **Type**: Bug
- **Solution**: Increased initial request to 25 songs with retry loop up to 3 attempts.

---

## Tasks 81-123

### 81. First-time user onboarding tutorial
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/TutorialView.swift, vibes/ContentView.swift
- **Solution**: Created comprehensive TutorialView.swift with 8 polished pages covering all features with animations.

### 82. Fix achievements sharing across accounts
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/Components/AchievementsView.swift
- **Solution**: Made LocalAchievementStats user-specific with key() helper appending userId to all UserDefaults keys.

### 83. Add 3 super secret achievements (Butterfly Effect, The Contrarian, The Resurrection)
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/Components/AchievementsView.swift, vibes/ViewModels/MessageThreadViewModel.swift
- **Solution**: Added 3 super secret achievements with isSuperSecret=true flag.

### 84. Search/filter friends list
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/ChatsView.swift
- **Solution**: Added search bar with filteredChats computed property filtering by displayName or username.

### 85. Visual depth with shadows and elevation
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/Components/CardStyle.swift
- **Solution**: Created CardStyle.swift ViewModifier with adaptive shadows for light/dark mode.

### 86. Music taste compatibility scores
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Services/CompatibilityService.swift
- **Solution**: Created CompatibilityService with Jaccard-like overlap algorithm and CompatibilityBadge component.

### 87. Group chats
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/ChatsView.swift, vibes/Models/GroupThread.swift
- **Solution**: Implemented complete group chat functionality with GroupThread model, CreateGroupView, GroupThreadView.

### 88. Fix group chats not showing in conversations
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/ChatsView.swift, vibes/Services/FirestoreService.swift
- **Solution**: Made groups section always visible with empty state and added error logging.

### 89. Fix achievements sharing across accounts (again)
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/Components/AchievementsView.swift
- **Solution**: Updated key() function to fall back to FirebaseAuth and return dummy key if no user logged in.

### 90. Fix Discover page sometimes missing sections
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/DiscoverView.swift
- **Solution**: Added onChange handlers and loading indicators for each section.

### 91. Prevent duplicate group chats and add moderator controls
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Services/FirestoreService.swift, vibes/Views/CreateGroupView.swift
- **Solution**: Added findExistingGroup() check and edit functionality for group creator.

### 92. Add delete group functionality for moderator
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Services/FirestoreService.swift, vibes/Views/GroupThreadView.swift
- **Solution**: Added deleteGroup() that deletes all messages and group document with confirmation.

### 93. Fix music compatibility using Spotify top artists instead of empty profile data
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/FirestoreService.swift, vibes/Views/ProfileView.swift
- **Solution**: Added syncTopArtistsToProfile() called from ProfileView and DiscoverViewModel.

### 94. Fix achievement banner not visible
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/Components/AchievementsView.swift, vibes/Views/ProfileView.swift
- **Failure Count**: 1
- **Solution**: Added padding to banner and cacheFirestoreStats() for complete achievement comparison.

### 95. Update New Releases to last 3 months and top 20 artists
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/ViewModels/DiscoverViewModel.swift
- **Solution**: Updated loadNewReleases() to use 3 months and top 20 artists.

### 96. Increase AI playlist song count to 15
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Services/GeminiService.swift
- **Solution**: Changed prompt from "Include 5-6 songs per playlist" to "Include exactly 15 songs per playlist"

### 97. Song sharing with multiple friends - individual or group option
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/FriendPickerView.swift
- **Solution**: Added confirmationDialog to FriendPickerView with individual or group sending options.

### 98. Group chat info view - clickable name instead of edit button
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/GroupThreadView.swift
- **Solution**: Replaced toolbar pencil button with tappable group name that opens GroupInfoView sheet.

### 99. Make DM input bar match group chat style
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/MessageThreadView.swift
- **Solution**: Removed plus button, changed TextField to .plain style with custom background.

### 100. Pass dismissed tracks to Gemini to avoid re-suggesting them
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Services/GeminiService.swift, vibes/ViewModels/DiscoverViewModel.swift
- **Solution**: Added avoidSongs parameter to Gemini with retry logic when all recommendations filtered.

### 101. Achievement banners only appear when visiting achievements page
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/ProfileView.swift, vibes/Views/Components/AchievementsView.swift
- **Solution**: Added loadAndCacheFirestoreStats() function called from AuthManager when user signs in.

### 102. Group chat messages don't count towards chatterbox achievements
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/GroupThreadView.swift
- **Solution**: Added messagesSent increment and checkLocalAchievements() call after group messages.

### 103. Songs in group chats can't be played
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/GroupThreadView.swift
- **Solution**: Added AudioPlayerService integration and play button to GroupMessageBubble.

### 104. Add context menu to group chat song messages
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/GroupThreadView.swift, vibes/Services/FirestoreService.swift
- **Solution**: Added context menu with reactions, send to friend, add to playlist, open in Spotify.

### 105. Interactive in-app tutorial with coach marks
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Services/CoachMarksService.swift, vibes/Views/Components/CoachMarksOverlay.swift
- **Solution**: Created coach marks system with spotlight and tooltips (later removed in task 113).

### 106. Swipe gesture to navigate between tabs
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/ContentView.swift
- **Solution**: Replaced TabView with horizontal ScrollView using scrollTargetBehavior(.paging).

### 107. AI Playlist Recommendations with checkmark system
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/PlaylistRecommendationsView.swift, vibes/ViewModels/PlaylistRecommendationsViewModel.swift
- **Solution**: Created PlaylistRecommendationsView with playlist selection and recommendation cards.

### 108. Vibestreak visual indicator for daily completion status
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/Components/VibestreakView.swift, vibes/Models/FriendProfile.swift
- **Solution**: Added vibestreakCompletedToday property with red/gray flame indicator.

### 109. Change New Releases to use top 10 artists instead of top 20
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/ViewModels/DiscoverViewModel.swift
- **Solution**: Changed getTopArtists limit from 20 to 10.

### 110. Increase Discover header left padding
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/DiscoverView.swift
- **Solution**: Changed padding to .horizontal, 20 for more breathing room.

### 111. Always show AI Picks For You title
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/DiscoverView.swift
- **Solution**: Changed condition to show section when Gemini is configured with empty state.

### 112. iTunes preview sometimes plays wrong song version (remix or different song)
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/iTunesService.swift
- **Solution**: Added isRemixOrAlternateVersion() function to filter wrong versions.

### 113. Remove interactive coach marks tutorial, keep only slideshow
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Services/CoachMarksService.swift, vibes/Views/Components/CoachMarksOverlay.swift
- **Solution**: Deleted coach marks files and removed all references.

### 114. Fix missing Firebase SPM packages in Xcode
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes.xcodeproj
- **Solution**: Ran xcodebuild -resolvePackageDependencies to resolve SPM packages.

### 115. Fix GroupThread decoding error for missing lastMessageType
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Models/GroupThread.swift
- **Solution**: Added custom init(from decoder:) with decodeIfPresent and "text" default.

### 116. Fix profile and friends failing to load due to missing Firestore fields
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Models/User.swift
- **Solution**: Added custom init(from decoder:) to UserProfile and PrivacySettings with defaults.

### 117. Fix context menu usability and reactions interaction
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/MessageThreadView.swift, vibes/Views/GroupThreadView.swift
- **Solution**: Flattened reaction submenu into direct buttons, made reactions tappable.

### 118. Split AchievementsView.swift into smaller files
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/Components/AchievementsView.swift, vibes/Models/, vibes/Services/
- **Solution**: Split 2145 lines into 4 files: Achievement.swift, AchievementDefinitions.swift, LocalAchievementStats.swift, AchievementsView.swift.

### 119. Nearby concerts for top Spotify artists
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/DiscoverView.swift, vibes/Services/TicketmasterService.swift
- **Solution**: Created TicketmasterService with concert cards on Discover page.

### 120. Code cleanup - Split ProfileView and DiscoverView
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/ProfileView.swift, vibes/Views/DiscoverView.swift
- **Solution**: Created ProfileHelperViews.swift and DiscoverHelperViews.swift.

### 121. Code cleanup - Split SearchView
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/SearchView.swift, vibes/Views/Components/SearchHelperViews.swift
- **Solution**: Created SearchHelperViews.swift, reduced SearchView from 802 to 371 lines.

### 122. Account creation fails with "missing or insufficient permissions"
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/AuthManager.swift
- **Solution**: Reordered signUp to create Firebase Auth user before checking username.

### 123. Replay Tutorial shows wrong tab selected
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/ProfileView.swift, vibes/ContentView.swift
- **Solution**: Added selectedTab binding and reset to 0 when replaying tutorial.

---
