# Archived Tasks - January 2025

This file contains completed tasks that were archived from docs/task.md.
Tasks 1-29 are stored here to keep the active task tracker under 300 lines.

---

## Tasks 1-17

Previously archived (details not preserved).

---

## Tasks 18-29

### 18. Debug friend request "User not found" issue
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/FriendService.swift
- **Requested**: User reports "User not found" when trying to add friend by username "caden123", but profile shows that user exists
- **Context**: FriendService.sendFriendRequest() queries Firestore for username but isn't finding the user. Could be case sensitivity, query issue, or data not saved correctly.
- **Solution**: Issue found - Firestore index missing for username queries. Added debug logging and documented fix steps.

### 19. Fix Firestore index error for notifications query
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/FriendService.swift:184-188
- **Requested**: Fix error "Failed to load notifications: The query requires an index" shown on Add Friend screen
- **Solution**: Created composite index in Firebase Console for notifications collection (userId Ascending, createdAt Descending).

### 20. Add unread notification count to notifications section header
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/FriendsView.swift:53-70, 242-251
- **Requested**: Show unread count badge next to "Notifications" header, with "99+" for counts over 99
- **Solution**: Added unreadCount computed property and red badge styling.

### 21. Remove username editing capability from profile
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/ProfileView.swift:119
- **Requested**: User should not be able to change their username
- **Solution**: Verified username is already read-only - no code changes needed.

### 22. Fix profile display name not updating
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Views/ProfileView.swift, vibes/ViewModels/ProfileViewModel.swift
- **Requested**: When editing profile display name, changes weren't persisting
- **Solution**: Refactored ProfileView to use ProfileViewModel's @Published properties instead of local state.

### 23. Hide email from friend detail view
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/FriendDetailView.swift, vibes/Models/FriendProfile.swift
- **Requested**: Friends should not see each other's email, only username, display name, and favorite genres
- **Solution**: Removed email property from FriendProfile model and removed infoSection from FriendDetailView.

### 24. Add settings menu to all screens
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: All View files
- **Requested**: Add profile picture icon to top-right with dropdown menu for Edit Profile, Switch Accounts, Sign Out
- **Solution**: Created SettingsMenu.swift component and integrated across all views.

### 25. Auto-save profile changes when switching tabs and remove sign out button
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/ProfileView.swift
- **Requested**: Auto-save profile edits when switching tabs, remove redundant sign out button
- **Solution**: Added onDisappear modifier for auto-save, removed signOutButton.

### 26. Remove switch accounts button and related code
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/SettingsMenu.swift, vibes/Views/AccountSwitcherView.swift
- **Requested**: Remove switch accounts functionality
- **Solution**: Removed button, state, and deleted AccountSwitcherView.swift.

### 27. Change menu to popover style to keep profile icon visible
- **Status**: COMPLETED
- **Type**: Feature
- **Location**: vibes/Views/SettingsMenu.swift
- **Requested**: Keep profile icon visible when menu is shown
- **Solution**: Replaced Menu component with Button + popover.

### 28. Debug and fix app crash on launch
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/Services/AuthManager.swift:22, vibes/Services/FirestoreService.swift:13, vibes/Services/FriendService.swift:14
- **Requested**: App crashes immediately on launch
- **Solution**: Fixed Firebase/Firestore initialization race condition by using lazy var for db properties.

### 29. Fix crash when exiting messaging screen
- **Status**: COMPLETED
- **Type**: Bug
- **Location**: vibes/ViewModels/MessageThreadViewModel.swift:159-163
- **Requested**: App crashes when exiting the messaging screen
- **Solution**: Removed unsafe nonisolated deinit pattern, cleanup now handled by onDisappear.

---
